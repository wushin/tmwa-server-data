030-2.gat,80,44,0|script|Avalia|356,
{
    callfunc "ClearVariables";
      if (@Q_status == 1) goto L_State_2;

    mes "[Avalia]";
    mes "\" Could you please help us? I have no big reward or anything. You see this nutcracker here beside me? He is different from the rest. He has a will of his own. Santa didn't approve but when he took his life force away from this nutcracker I gave up some of mine to keep him alive.\"";
    mes "\" Please you must find a way to make him real before Christmas. At Christmas I will need all my power to cast the spells for Santa. I don't know what to do but you must help because I love him.\"";
    mes "\" Will you help us please. I don't know what I'll do casting those spells for all the children but letting my love die.\"";
      menu
          "You are a weirdo there is no way i'm helping you", L_Close,
          "Okay I'll help.", L_Thanks,
          "Okay I know what you need to do.", L_Really;
     
L_Really:
    mes "[Avalia]";
    mes "\" Okay you said it goes transmutation, astral, then nature right?\"";
      menu
          "Right", L_Start,
          "No.", L_How;
L_How:
    mes"\" Well if you don't know how it goes then that's no help go find out for me please so we can do this.\"";
    goto L_Close;

L_Start:
        // Check that the player has the needed items
    if (countitem("CherryCake") < 1 || countitem("DiseasedHeart") < 5 ||countitem("Root") < 3 ||countitem("Pearl") < 3)
    goto L_Enough;
     
       
    // Remove the items
    delitem "CherryCake", 1;
    delitem "DiseasedHeart", 5;
    delitem "Root", 3;
    delitem "Pearl", 3;
    
    // Set quest state var here
    set @Q_status, 1;
    mes "\" Okay here we go.\"";      
    mes " She takes the zombie hearts and presses them into the wood saying #Vehust as she does so";
    mes " Then she takes the roots and makes a small fire with them then she crushes the three pearls and sprinkles it over the fire saying #galalathad";
    mes " Then she takes the cherry cake and gently feeds her love saying #talasin";
    mes "\" She drops her spell on the wooden creature and whispers something in his ear and he laughs\"";
    mes "\" You did it. Thank you so much! I'll never forget this.\"";
    mes "\" I have a present for you.\"";
    //give present here
    goto L_Thanks;
     
L_Thanks:
    set @Q_status, 2;
    mes "[Avalia]";
    mes "\" Thank you so much I don't know how I'll ever repay you.\"";
    set FLAGS, FLAGS | FLAG_AVALIA;
    goto L_Close;
     
L_Enough:
    mes "\" I'm sorry but could you come back when you have the components?\""; 
    goto L_Close;
     
L_Close:
    close;
}
