// The ferry system

botcheck.gat,27,28,0|script|#FerryConfig|-1,
{
OnInit:
    disablenpc "#HurnscaldKoga";
    disablenpc "#HurnscaldFerry";
    disablenpc "#CandorKoga";
    disablenpc "#CandorFerry";
    disablenpc "#NivalisKoga";
    disablenpc "#NivalisFerry";
    disablenpc "#TulimsharKoga";
    disablenpc "#TulimsharFerry";
    set $@CurrentDock, 0;
    set $@DockTickCount, 0;
    set $@DockLeaveCount, 1;
    setarray $@Docks$, "Hurnscald", "Candor", "Nivalis", "Tulimshar";
    cmdothernpc "#"+$@Docks$[$@CurrentDock]+"Dock", "Arrive";
    initnpctimer;
    end;

L_NextDock:
    set $@LastDock, $@CurrentDock;
    set $@CurrentDock, $@CurrentDock + 1;
    if($@CurrentDock == getarraysize($@Docks$))
        set $@CurrentDock, 0;
    set $@DockTickCount, 0;
    cmdothernpc "#"+$@Docks$[$@LastDock]+"Dock", "Warp";
    cmdothernpc "#"+$@Docks$[$@CurrentDock]+"Dock", "Arrive";
    initnpctimer;
    end;

OnTimer20000:
    if ($@DockTickCount > $@DockLeaveCount)
        goto L_NextDock;
    if ($@DockTickCount)
        cmdothernpc "#"+$@Docks$[$@CurrentDock]+"Dock", "Annouce";
    set $@DockTickCount, $@DockTickCount + 1;
    initnpctimer;
    end;

}

function|script|BoardFerry|,
{
    mes "Board the ferry?";
    menu
        "yes.", L_Board,
        "no.", L_Return;

L_Board:
    warp "koga.gat",39,29;
    goto L_Return;

L_Return:
    return;
}
