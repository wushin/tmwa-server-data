// Torches used within the Witch Cult Quest (see Troll Mask Guy in 043-4).
// Author: Cassy

//Torch on the side path
005-3.gat,85,45,0|script|#WitchCultTorch8|400
{
    set @AMOUNT_LARGEHEALINGPOTION, 1;
    set @AMOUNT_SULPHURPOWDER, 1;
    set @AMOUNT_SNAKEEGG, 5;
    set @AMOUNT_BLACKSCORPIONSTINGER, 3;

    if (isin("005-3.gat", 84, 44, 86, 46))
        goto L_Torch;
    mes "You sense a mystical aura coming from this direction. You will need to get closer to find out more.";
    goto L_Close;

L_Torch:
    if (Witch_Cult_Quest == 0) goto L_Unknown;
    if (Witch_Cult_Torch8 == 1) goto L_SummonFinished;
    mes "[Mystical Torch]";
    mes "This is one of the Witch Cult's torches the Troll Mask Guy talked about.";
    mes "";
    mes "When you pour the ingredients into its flame it will weaken the barrier to Kalinoir's Cave.";
    next;
    mes "Do you want to do so?";
    menu
        "Pour them in.", L_DisableTorch,
        "No, not yet.", L_Close;

L_DisableTorch:
    set @LocalMonsterCount,
        mobcount("005-3.gat", "#WitchCultTorch8::OnMobsDeath") +
        1; // the mobcount function has an offset of -1, so we add 1 to have the actual amount of monsters
    if (@LocalMonsterCount > 0)
        goto L_MonstersAlive;
    if ((countitem("LargeHealingPotion") < @AMOUNT_LARGEHEALINGPOTION)
        || (countitem("SulphurPowder") < @AMOUNT_SULPHURPOWDER)
        || (countitem("SnakeEgg") < @AMOUNT_SNAKEEGG)
        || (countitem("BlackScorpionStinger") < @AMOUNT_BLACKSCORPIONSTINGER))
        goto L_NoItem;

    delitem "LargeHealingPotion", @AMOUNT_LARGEHEALINGPOTION;
    delitem "SulphurPowder", @AMOUNT_SULPHURPOWDER;
    delitem "SnakeEgg", @AMOUNT_SNAKEEGG;
    delitem "BlackScorpionStinger", @AMOUNT_BLACKSCORPIONSTINGER;
    set Witch_Cult_Torch8, 1;

    mes "[Mystical Torch]";
    mes "You pour the ingredients into the flame and while you do so the flame gets bigger and warmer.";
    mes "";
    mes "You sense a strong aura, probably magical, but then it vanishes as the flame turns back to its usual size.";
    next;
    mes "The pressure in this cave increased. It seems that the torch performed a summon with its final breath. You better be careful!";
    mes "";

    setarray $@witchculttorch8_x0, 92, 92, 22;
    setarray $@witchculttorch8_y0, 41, 41, 30;
    setarray $@witchculttorch8_x1, 98, 98, 31;
    setarray $@witchculttorch8_y1, 47, 47, 39;
    setarray $@witchculttorch8_IDs, 1054, 1117, 1116;
    setarray $@witchculttorch8_QTYs, 1, 2, 2;

    set @witchculttorch8_loop, 2;
    areamonster "005-3.gat", $@witchculttorch8_x0[@witchculttorch8_loop], $@witchculttorch8_y0[@witchculttorch8_loop], $@witchculttorch8_x1[@witchculttorch8_loop], $@witchculttorch8_y1[@witchculttorch8_loop], "", $@witchculttorch8_IDs[@witchculttorch8_loop], $@witchculttorch8_QTYs[@witchculttorch8_loop], "#WitchCultTorch8::OnMobsDeath";

    goto L_SummonFinished;

OnMobsDeath:
    getexp 17000, 0;
    message strcharinfo(0), "You feel some dark magic vanishing and gain 17,000 experience points.";
    end;

L_MonstersAlive:
    mes "[Mystical Torch]";
    mes "The pressure in this cave is depressingly high and this torch's aura seems to be weakened.";
    mes "";
    mes "It seems like a summon has happened here not too long ago.";
    next;
    mes "You better look for the remains of this summon and get rid of them as they seem to disturb the torch's magical abilities.";
    goto L_Close;

L_NoItem:
    mes "You don't have the required items to perform the task.";
    goto L_Close;

L_SummonFinished:
    mes "Aside from its blue color this is now just a normal torch. Its mystical warmth and aura completely disappeared.";
    goto L_Close;

L_Unknown:
    mes "This torch is different than others and not only because of its blue flame. It is also warmer and gives off a strong aura. What is this torch?";
    goto L_Close;

L_Close:
    close;
}

//Torch next to the bridge
005-3.gat,118,97,0|script|#WitchCultTorch9|400
{
    set @AMOUNT_LARGEHEALINGPOTION, 1;
    set @AMOUNT_SULPHURPOWDER, 1;
    set @AMOUNT_SNAKEEGG, 5;
    set @AMOUNT_BLACKSCORPIONSTINGER, 3;

    if (isin("005-3.gat", 106, 94, 110, 101))
        goto L_SeeTorch;
    if (isin("005-3.gat", 117, 97, 118, 98))
        goto L_Torch;
    mes "You sense a mystical aura coming from this direction. You will need to get closer to find out more.";
    goto L_Close;

L_SeeTorch:
    mes "[Mystical Torch]";
    mes "You can see this torch with its mystical blue flame but you can't reach it from this place. You must find a way there.";
    goto L_Close;

L_Torch:
    if (Witch_Cult_Quest == 0) goto L_Unknown;
    if (Witch_Cult_Torch9 == 1) goto L_SummonFinished;
    mes "[Mystical Torch]";
    mes "This is one of the Witch Cult's torches the Troll Mask Guy talked about.";
    mes "";
    mes "When you pour the ingredients into its flame it will weaken the barrier to Kalinoir's Cave.";
    next;
    mes "Do you want to do so?";
    menu
        "Pour them in.", L_DisableTorch,
        "No, not yet.", L_Close;

L_DisableTorch:
    set @LocalMonsterCount,
        mobcount("005-3.gat", "#WitchCultTorch9::OnMobsDeath") +
        1; // the mobcount function has an offset of -1, so we add 1 to have the actual amount of monsters
    if (@LocalMonsterCount > 0)
        goto L_MonstersAlive;
    if ((countitem("LargeHealingPotion") < @AMOUNT_LARGEHEALINGPOTION)
        || (countitem("SulphurPowder") < @AMOUNT_SULPHURPOWDER)
        || (countitem("SnakeEgg") < @AMOUNT_SNAKEEGG)
        || (countitem("BlackScorpionStinger") < @AMOUNT_BLACKSCORPIONSTINGER))
        goto L_NoItem;

    delitem "LargeHealingPotion", @AMOUNT_LARGEHEALINGPOTION;
    delitem "SulphurPowder", @AMOUNT_SULPHURPOWDER;
    delitem "SnakeEgg", @AMOUNT_SNAKEEGG;
    delitem "BlackScorpionStinger", @AMOUNT_BLACKSCORPIONSTINGER;
    set Witch_Cult_Torch9, 1;

    mes "[Mystical Torch]";
    mes "You pour the ingredients into the flame and while you do so the flame gets bigger and warmer.";
    mes "";
    mes "You sense a strong aura, probably magical, but then it vanishes as the flame turns back to its usual size.";
    next;
    mes "The pressure in this cave increased. It seems that the torch performed a summon with its final breath. You better be careful!";
    mes "";

    setarray $@witchculttorch9_x0, 101, 101, 106, 106;
    setarray $@witchculttorch9_y0, 64, 64, 94, 94;
    setarray $@witchculttorch9_x1, 107, 107, 108, 108;
    setarray $@witchculttorch9_y1, 75, 75, 99, 99;
    setarray $@witchculttorch9_IDs, 1054, 1117, 1116, 1062;
    setarray $@witchculttorch9_QTYs, 2, 1, 1, 1;

    set @witchculttorch9_loop, 3;
    areamonster "005-3.gat", $@witchculttorch9_x0[@witchculttorch9_loop], $@witchculttorch9_y0[@witchculttorch9_loop], $@witchculttorch9_x1[@witchculttorch9_loop], $@witchculttorch9_y1[@witchculttorch9_loop], "", $@witchculttorch9_IDs[@witchculttorch9_loop], $@witchculttorch9_QTYs[@witchculttorch9_loop], "#WitchCultTorch9::OnMobsDeath";

    goto L_SummonFinished;

OnMobsDeath:
    getexp 17000, 0;
    message strcharinfo(0), "You feel some dark magic vanishing and gain 17,000 experience points.";
    end;

L_MonstersAlive:
    mes "[Mystical Torch]";
    mes "The pressure in this cave is depressingly high and this torch's aura seems to be weakened.";
    mes "";
    mes "It seems like a summon has happened here not too long ago.";
    next;
    mes "You better look for the remains of this summon and get rid of them as they seem to disturb the torch's magical abilities.";
    goto L_Close;

L_NoItem:
    mes "You don't have the required items to perform the task.";
    goto L_Close;

L_SummonFinished:
    mes "Aside from its blue color this is now just a normal torch. Its mystical warmth and aura completely disappeared.";
    goto L_Close;

L_Unknown:
    mes "This torch is different than others and not only because of its blue flame. It is also warmer and gives off a strong aura. What is this torch?";
    goto L_Close;

L_Close:
    close;
}
